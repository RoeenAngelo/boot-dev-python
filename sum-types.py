# Sum Types Practice
# Doc2Doc should be able to prepare and export a CSV file of whatever data you input. Comma-Separated Values are a ubiquitous text format that allows for information to be structured in a table. There is usually a header row, followed by data rows. Within rows, items are separated by commas.

# Assignment
# Complete the get_csv_status function. It should use a match case statement to select the correct response depending on the status of the export operation. Create functions to handle each operation as follows:

# PENDING: return a tuple with the string "Pending..." and the data converted from a list of lists of anything, to a list of lists of strings.
# Try to use nested map functions to convert the data items into strings.
# Remember to convert from a map object back into a list.
# PROCESSING: return a tuple with the string "Processing..." and the data converted from a list of lists of strings into one string in CSV format.
# For each list of strings, combine the strings with join with commas in between to form a row.
# For each row string, combine the strings with join with newlines "\n" in between to form a table.
# SUCCESS: return a tuple with the string "Success!" and simply return the data as is.
# FAILURE: return a tuple with the string "Unknown error, retrying..." and the data after it has been prepared and processed into a CSV string, by combining the steps for Pending and Processing.
# Any Other Status: raise an Exception with the string "unknown export status".
# Tip
# It's better if you try this challenge without using loops for practice, but you may use loops.

from enum import Enum

CSVExportStatus = Enum(
    "CSVExportStatus", ["PENDING", "PROCESSING", "SUCCESS", "FAILURE"]
)


def get_csv_status(status, data):
    match (status, data):
        case (CSVExportStatus.PENDING, _):
            return ("Pending...", list(map(lambda sublist: list(map(lambda item: str(item), sublist)), data)))
        case (CSVExportStatus.PROCESSING, _):
            return f"Processing...", "\n".join(list(map(lambda sublist: ",".join(sublist), data)))
        case (CSVExportStatus.SUCCESS, _):
            return ('Success!', data)
        case (CSVExportStatus.FAILURE, _):
            str_list = list(map(lambda sublist: list(map(lambda item: str(item), sublist)), data))
            step_3 = "\n".join(list(map(lambda sublist: ",".join(sublist), str_list)))
            return ('Unknown error, retrying...', step_3)     
        case _:
            raise Exception("unknown export status")